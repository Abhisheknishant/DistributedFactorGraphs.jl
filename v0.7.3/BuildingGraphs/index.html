<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Building Graphs · DistributedFactorGraphs.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>DistributedFactorGraphs.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../DataStructure/">Data Structure</a></li><li><span class="toctext">Getting Started</span><ul><li><a class="toctext" href="../getting_started/">Introduction</a></li><li class="current"><a class="toctext" href>Building Graphs</a><ul class="internal"><li><a class="toctext" href="#Initializing-a-Graph-1">Initializing a Graph</a></li><li><a class="toctext" href="#Creating-Variables-and-Factors-1">Creating Variables and Factors</a></li><li><a class="toctext" href="#Listing-Variables-and-Factors-1">Listing Variables and Factors</a></li><li><a class="toctext" href="#Getting-(Reading)-Variables-and-Factors-1">Getting (Reading) Variables and Factors</a></li><li><a class="toctext" href="#Updating-Variables-and-Factors-1">Updating Variables and Factors</a></li><li><a class="toctext" href="#Deleting-Variables-and-Factors-1">Deleting Variables and Factors</a></li></ul></li><li><a class="toctext" href="../GraphData/">Using Graph Data</a></li><li><a class="toctext" href="../DrawingGraphs/">Drawing Graphs</a></li><li><a class="toctext" href="../TraversingAndQuerying/">Traversing and Querying</a></li><li><a class="toctext" href="../ref_api/">Common API Interface</a></li></ul></li><li><span class="toctext">DistributedFactorGraph API&#39;s</span><ul><li><a class="toctext" href="../apis/graphs/">Graphs.jl</a></li><li><a class="toctext" href="../apis/graphs/">LightGraphs.jl</a></li><li><a class="toctext" href="../apis/graphs/">CloudGraphs.jl</a></li></ul></li><li><a class="toctext" href="../func_ref/">Reference</a></li></ul></nav><article id="docs"><header><nav><ul><li>Getting Started</li><li><a href>Building Graphs</a></li></ul><a class="edit-page" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/master/docs/src/BuildingGraphs.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Building Graphs</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Creating-Graphs-1" href="#Creating-Graphs-1">Creating Graphs</a></h1><p>In this section constructing DFG graphs will be discussed. To start, bring DistributedFactorGraphs into your workspace:</p><pre><code class="language-julia">using DistributedFactorGraphs</code></pre><p>We recommend using IncrementalInference (IIF) to populate DFG graphs. DFG provides the structure, but IIF overloads the provided <code>addVariable!</code> and <code>addFactor!</code> functions and creates solver-specific data that allows the graph to be solved. So although you can use DFG&#39;s <code>addVariable!</code> and <code>addFactor!</code>, it is better to start with IIF&#39;s functions so that the graph is solvable.</p><p>So for the following examples, IncrementalInference will be used to create the variables and factors. It should be added and imported to run the examples:</p><pre><code class="language-julia">using Pkg
Pkg.add(&quot;IncrementalInference&quot;)
using IncrementalInference</code></pre><h2><a class="nav-anchor" id="Initializing-a-Graph-1" href="#Initializing-a-Graph-1">Initializing a Graph</a></h2><p>DFG graphs can be built using various drivers (different representations of the underlying graph). At the moment DFG supports 3 drivers:</p><ul><li>GraphsDFG: An in-memory graph that uses Graphs.jl for representing the graph.</li><li>LightDFG: An in-memory graph that uses LightGraphs.jl for representing the graph.</li><li>CloudGraphs: A database-driven graph that uses Neo4j.jl for interacting with the graph.</li></ul><p>In general the first two are used for building and solving graphs, and CloudGraphs is used for persisting in-memory graphs into a database. In the long term we recommend using the LightDFG driver for in-memory operation because Graphs.jl is not actively supported and over time that driver may be deprecated.</p><p>To continue the example, run one of the following to create a DFG driver:</p><h3><a class="nav-anchor" id="Creating-a-GraphsDFG-Graph-1" href="#Creating-a-GraphsDFG-Graph-1">Creating a GraphsDFG Graph</a></h3><pre><code class="language-julia"># Create a DFG with default solver parameters using the Graphs.jl driver.
dfg = GraphsDFG{SolverParams}(params=SolverParams())</code></pre><h3><a class="nav-anchor" id="Creating-a-LightDFG-Graph-1" href="#Creating-a-LightDFG-Graph-1">Creating a LightDFG Graph</a></h3><pre><code class="language-julia"># Create a DFG with default solver parameters using the LightGraphs.jl driver.
dfg = LightDFG{SolverParams}(params=SolverParams())</code></pre><h3><a class="nav-anchor" id="Creating-a-CloudGraphsDFG-Graph-1" href="#Creating-a-CloudGraphsDFG-Graph-1">Creating a CloudGraphsDFG Graph</a></h3><pre><code class="language-julia"># Create a DFG with no solver parameters (just to demonstrate the difference) using the CloudGraphs driver, and connect it to a local Neo4j instance.
dfg = CloudGraphsDFG{NoSolverParams}(&quot;localhost&quot;, 7474, &quot;neo4j&quot;, &quot;test&quot;,
                                &quot;testUser&quot;, &quot;testRobot&quot;, &quot;testSession&quot;,
                                nothing,
                                nothing,
                                IncrementalInference.decodePackedType,
                                IncrementalInference.rebuildFactorMetadata!)</code></pre><h2><a class="nav-anchor" id="Creating-Variables-and-Factors-1" href="#Creating-Variables-and-Factors-1">Creating Variables and Factors</a></h2><p>DFG and IIF rely on a CRUD (Create, Read, Update, and Delete) interface to allow users to create and edit graphs.</p><h3><a class="nav-anchor" id="Creating-Variables-with-IIF-1" href="#Creating-Variables-with-IIF-1">Creating Variables with IIF</a></h3><p>Variables are added using IncrementalInference&#39;s <code>addVariable!</code> function. To create the variable, you provide the following parameters:</p><ul><li>The graph the variable is being added to</li><li>The variable&#39;s label (e.g. :x1 or :a)</li><li>The variable inference type (aka soft type), which is a subtype of InferenceVariable</li></ul><p><strong>NOTE</strong>: Once variables are initialized to a specific soft type, variable node data (solver data) is templated to that type. </p><p>In addition, the following optional parameters are provided:</p><ul><li>Additional labels for the variable (in DFG these are referred to as tags)</li><li>A <code>solvable</code> flag to indicate whether the variable is ready to be added to a solution</li></ul><p>Three variables are added:</p><pre><code class="language-julia">v1 = addVariable!(dfg, :x0, ContinuousScalar, labels = [:POSE], solvable=1)
v2 = addVariable!(dfg, :x1, ContinuousScalar, labels = [:POSE], solvable=1)
v3 = addVariable!(dfg, :l0, ContinuousScalar, labels = [:LANDMARK], solvable=1)</code></pre><h3><a class="nav-anchor" id="Creating-Factors-with-IIF-1" href="#Creating-Factors-with-IIF-1">Creating Factors with IIF</a></h3><p>Similarly to variables, it is recommended that users start with the IIF implementation of the <code>addFactor!</code> functions to create factors. To create the factors, you provide the following parameters:</p><ul><li>The graph the variable is being added to</li><li>The labels for the variables that the factor is linking</li><li>The factor function (which is a subtype of )</li></ul><p>Additionally, the solvable flag is also set to indicate that the factor can be used in solving graphs.</p><p><strong>NOTE:</strong> Every graph requires a prior for it to be solvable, so it is a good practice to make sure one is added (generally by adding to the first variable in the graph).</p><p>Four factors are added: a prior, a linear conditional relationship with a normal distribution between x0 and x1, and a pair of linear conditional relationships between each pose and the landmark.</p><pre><code class="language-julia">prior = addFactor!(dfg, [:x0], Prior(Normal(0,1)))
f1 = addFactor!(dfg, [:x0; :x1], LinearConditional(Normal(50.0,2.0)), solvable=1)
f1 = addFactor!(dfg, [:l0; :x0], LinearConditional(Normal(40.0,5.0)), solvable=1)
f1 = addFactor!(dfg, [:l0; :x1], LinearConditional(Normal(-10.0,5.0)), solvable=1)</code></pre><p>The produced factor graph is:</p><p><img src="../imgs/initialgraph.jpg" alt="imgs/initialgraph.jpg"/></p><p>(For more information on producing plots of the graph, please refer to the <a href="../DrawingGraphs/">Drawing Graphs</a> section).</p><h2><a class="nav-anchor" id="Listing-Variables-and-Factors-1" href="#Listing-Variables-and-Factors-1">Listing Variables and Factors</a></h2><p>Reading, updating, and deleting all use DFG functions (as opposed to adding, where using the IncrementalInference functions are recommended).</p><p>Each variable and factor is uniquely identified by its label. The list of variable and factor labels can be retrieved with the <code>ls</code>/<code>listVariables</code> and <code>lsf</code>/<code>listFactors</code> functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.listVariables" href="#DistributedFactorGraphs.listVariables"><code>DistributedFactorGraphs.listVariables</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">listVariables(dfg)
listVariables(dfg, regexFilter; tags, solvable)
</code></pre><p>Get a list of IDs of the DFGVariables in the DFG. Optionally specify a label regular expression to retrieves a subset of the variables. Tags is a list of any tags that a node must have (at least one match).</p><p>Example</p><pre><code class="language-julia">listVariables(dfg, r&quot;l&quot;, tags=[:APRILTAG;])</code></pre><p>Related:</p><ul><li>ls</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L438-L451">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.ls" href="#DistributedFactorGraphs.ls"><code>DistributedFactorGraphs.ls</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>List the DFGVariables in the DFG. Optionally specify a label regular expression to retrieves a subset of the variables. Tags is a list of any tags that a node must have (at least one match).</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L473-L479">source</a><div><div><pre><code class="language-julia">ls(dfg)
ls(dfg, node; solvable)
</code></pre><p>Retrieve a list of labels of the immediate neighbors around a given variable or factor.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L495-L498">source</a><div><div><p>Retrieve a list of labels of the immediate neighbors around a given variable or factor specified by its label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L502-L505">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.listFactors" href="#DistributedFactorGraphs.listFactors"><code>DistributedFactorGraphs.listFactors</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>Get a list of the IDs (labels) of the DFGFactors in the DFG. Optionally specify a label regular expression to retrieves a subset of the factors.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L457-L461">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.lsf" href="#DistributedFactorGraphs.lsf"><code>DistributedFactorGraphs.lsf</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>List the DFGFactors in the DFG. Optionally specify a label regular expression to retrieves a subset of the factors.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L485-L489">source</a><div><div><p>Alias for getNeighbors - returns neighbors around a given node label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L510-L513">source</a></section><p>To list all variables or factors (instead of just their labels), use the <code>getVariables</code> and <code>getFactors</code> functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.getVariables" href="#DistributedFactorGraphs.getVariables"><code>DistributedFactorGraphs.getVariables</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>List the DFGVariables in the DFG. Optionally specify a label regular expression to retrieves a subset of the variables. Tags is a list of any tags that a node must have (at least one match).</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L240-L245">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.getFactors" href="#DistributedFactorGraphs.getFactors"><code>DistributedFactorGraphs.getFactors</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>List the DFGFactors in the DFG. Optionally specify a label regular expression to retrieves a subset of the factors.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L250-L254">source</a></section><p><strong>NOTE</strong>: <code>getNeighbors</code> is also worth mentioning at this point as it is a simple way to find the bigraph relationships. More information on this and other ways to retrieve filtered lists of variables/factors (an area that&#39;s currently WIP in DFG) can be found in <a href="../TraversingAndQuerying/">Traversing and Querying</a>.  </p><h2><a class="nav-anchor" id="Getting-(Reading)-Variables-and-Factors-1" href="#Getting-(Reading)-Variables-and-Factors-1">Getting (Reading) Variables and Factors</a></h2><p>Individual variables and factors can be retrieved from their labels using the following functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.getVariable" href="#DistributedFactorGraphs.getVariable"><code>DistributedFactorGraphs.getVariable</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">getVariable(dfg, label)
</code></pre><p>Get a DFGVariable from a DFG using its label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L194-L197">source</a><div><div><pre><code class="language-julia">getVariable(dfg, label, solveKey)
</code></pre><p>Get a DFGVariable with a specific solver key. In memory types still return a reference, other types returns a variable with only solveKey.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L343-L347">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.getFactor" href="#DistributedFactorGraphs.getFactor"><code>DistributedFactorGraphs.getFactor</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>Get a DFGFactor from a DFG using its label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L202-L205">source</a></section><p>It is worth noting that <code>getVariable</code> allows a user to retrieve only a single solver entry, so that subsets of the solver data can be retrieved individually (say, in the case that there are many solutions). These can then be updated independently using the functions as discussed in the update section below.</p><h2><a class="nav-anchor" id="Updating-Variables-and-Factors-1" href="#Updating-Variables-and-Factors-1">Updating Variables and Factors</a></h2><p>Full variables and factors can be updated using the following functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.updateVariable!" href="#DistributedFactorGraphs.updateVariable!"><code>DistributedFactorGraphs.updateVariable!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">updateVariable!(dfg, variable)
</code></pre><p>Update a complete DFGVariable in the DFG.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L209-L212">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.updateFactor!" href="#DistributedFactorGraphs.updateFactor!"><code>DistributedFactorGraphs.updateFactor!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>Update a complete DFGFactor in the DFG.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L217-L220">source</a></section><p><strong>NOTE</strong>: Skeleton and summary variables are read-only. To perform updates you should use the full factors and variables.</p><p><strong>NOTE</strong>: <code>updateVariable</code>/<code>updateFactor</code> performs a complete update of the respective node. It&#39;s not a very efficient way to edit fine-grain detail. There are other methods to perform smaller in-place changes. This is discussed in more detail in <a href="../DataStructure/">Data Structure</a>.</p><h2><a class="nav-anchor" id="Deleting-Variables-and-Factors-1" href="#Deleting-Variables-and-Factors-1">Deleting Variables and Factors</a></h2><p>Variables and factors can be deleted using the following functions:</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.deleteVariable!" href="#DistributedFactorGraphs.deleteVariable!"><code>DistributedFactorGraphs.deleteVariable!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><p>Delete a DFGVariable from the DFG using its label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L225-L228">source</a><div><div><p>Delete a referenced DFGVariable from the DFG.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L388-L391">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="DistributedFactorGraphs.deleteFactor!" href="#DistributedFactorGraphs.deleteFactor!"><code>DistributedFactorGraphs.deleteFactor!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">deleteFactor!(dfg, label)
</code></pre><p>Delete a DFGFactor from the DFG using its label.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L232-L235">source</a><div><div><pre><code class="language-julia">deleteFactor!(dfg, factor)
</code></pre><p>Delete the referened DFGFactor from the DFG.</p></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaRobotics/DistributedFactorGraphs.jl/blob/6877337fa92c95aa043e68b56200ed121ea176ec/src/services/AbstractDFG.jl#L396-L399">source</a></section><footer><hr/><a class="previous" href="../getting_started/"><span class="direction">Previous</span><span class="title">Introduction</span></a><a class="next" href="../GraphData/"><span class="direction">Next</span><span class="title">Using Graph Data</span></a></footer></article></body></html>
